<div *ngIf="treeData">
  <nz-row style="padding-bottom: 10px;">
    <nz-col>
      <button nzType="primary" nz-button (click)="treeStatusChange('isExpanded', !isExpanded)">{{ (isExpanded) ? '全部收合' : '全部展開' }}</button>
      <fs-edit-code style="padding-left: 8px; padding-right: 8px;" [type]="'Add'" [parentId]="selectedDefinition.codes.id" [definitionNos]="selectedDefinition.codes.no" [definitionId]="selectedDefinition.codes.id" [settingGroups]="settingGroups"></fs-edit-code>
      <button nz-button nzType="primary" (click)="save()">儲存變更</button>
      <button nzType="danger" nz-button (click)="loadData()">取消變更</button>
    </nz-col>
  </nz-row>
  <nz-row>
    <nz-col>
      <fs-ng-alain-tree
        [tree]="treeData"
        [showCountType]="2"
        [nzDefaultExpandAll]="isExpanded"
        [nzCheckable]="false"
        [showCheckAll]="false"
        [leafNodes]="true"
        [nzDraggable]="false"
        [nzShowLine]="true"
        [nzDefaultSearch]="true"
        [nzTreeTemplate]="nzTreeTemplate"
      ></fs-ng-alain-tree>
    </nz-col>
  </nz-row>

  <ng-template #nzTreeTemplate let-node>
    <span class="custom-node" [class.node-active]="seletedNode == node.key" [class.textColor]="editedData[node.key]" (click)="selectNode(node)" [innerHtml]="searchColor(node)"></span><br />
    <div *ngIf="seletedNode == node.key" style="padding-left: 22px;" >
      <div style="padding-top: 5px;">
        <fs-edit-code style="padding-right: 8px;" [type]="'Add'" [parentId]="node.key" [definitionNos]="selectedDefinition.codes.no" [definitionId]="node.origin.definitionId" [settingGroups]="settingGroups"></fs-edit-code>
        <button nz-button nzType="primary" (click)="setting(true, node.key)">設定</button>
        <button nz-button nzType="danger" (click)="deleteNode(node.key)">刪除</button>
      </div>
      <form nz-form [formGroup]="form">
        <div [formGroupName]="node.key" style="margin-left: -95px!important;">
          <nz-form-item style="margin-bottom: 15px!important;">
            <nz-form-label [nzSm]="5" [nzXs]="24" nzRequired>ID</nz-form-label>
            <nz-form-control [nzSm]="18" [nzXs]="24">
              {{ node.key }}
            </nz-form-control>
          </nz-form-item>
          <nz-form-item style="margin-bottom: 15px!important;">
            <nz-form-label [nzSm]="5" [nzXs]="24" nzRequired>啟用</nz-form-label>
            <nz-form-control [nzSm]="18" [nzXs]="24">
              <label nz-checkbox name="enable" formControlName="enable"></label>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item style="margin-bottom: 15px!important;">
            <nz-form-label [nzSm]="5" [nzXs]="24" nzRequired>代碼</nz-form-label>
            <nz-form-control [nzSm]="18" [nzXs]="24">
              <input nz-input type="text" [name]="node.origin.no" formControlName="no"/>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item style="margin-bottom: 15px!important;">
              <nz-form-label [nzSm]="5" [nzXs]="24" nzRequired>名稱</nz-form-label>
              <nz-form-control [nzSm]="18" [nzXs]="24">
                <input nz-input type="text" [name]="node.origin.displayName" formControlName="displayName"/>
              </nz-form-control>
          </nz-form-item>
          <nz-form-item style="margin-bottom: 15px!important;">
              <nz-form-label [nzSm]="5" [nzXs]="24">說明</nz-form-label>
              <nz-form-control [nzSm]="18" [nzXs]="24">
                <textarea nz-input [name]="node.origin.description" formControlName="description" [nzAutosize]="{ minRows: 4, maxRows: 6 }"></textarea>
              </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzSm]="5" [nzXs]="24">設定</nz-form-label>
            <nz-form-control [nzSm]="18" [nzXs]="24">
                <nz-select nzMode="multiple" name="configSetting" formControlName="configSetting" nzPlaceHolder="選擇">
                    <nz-option *ngFor="let item of settingGroups" [nzLabel]="item" [nzValue]="item"></nz-option>
                </nz-select>
            </nz-form-control>
        </nz-form-item>
        </div>
      </form>
    </div>
  </ng-template>

  <fs-ng-alain-setting-management [providerName]="providerName" [providerKey]="providerKey" [(visible)]="visible" [rawData]="selectedSetting"></fs-ng-alain-setting-management>
</div>
